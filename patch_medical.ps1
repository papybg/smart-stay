# Medical Emergency Expansion for checkEmergencyPower

$content = Get-Content 'c:\dev\smart-stay\services\ai_service.js' -Raw -Encoding UTF8

$oldPattern = '    // –ê–í–¢–û–ú–ê–¢–ò–ó–ê–¶–ò–Ø –ù–ê –¢–û–ö: –°–∞–º–æ –∑–∞ –≥–æ—Å—Ç–∏
    if (role !== ''guest'') {
        console.log(''[POWER] –ù–µ –µ –≥–æ—Å—Ç - –ø—Ä–æ–ø—É—Å–∫–∞–º –ø—Ä–æ–≤–µ—Ä–∫–∏—Ç–µ –Ω–∞ —Ç–æ–∫'');
        return "";
    }

    // –†–∞–∑–ø–æ–∑–Ω–∞–≤–∞ –∫–ª—é—á–æ–≤–∏ –¥—É–º–∏ –Ω–∞ –±—ä–ª–≥–∞—Ä—Å–∫–∏ –µ–∑–∏–∫, —Å–≤—ä—Ä–∑–∞–Ω–∏ —Å –ª–∏–ø—Å–∞ –Ω–∞ —Ç–æ–∫
    const emergencyPowerKeywords = /–Ω—è–º–∞ —Ç–æ–∫|–±–µ–∑ —Ç–æ–∫|–Ω–µ —Ä–∞–±–æ—Ç–∏ —Ç–æ–∫|—Å–ø—Ä—è–Ω —Ç–æ–∫|–∏–∑–∫–ª—é—á–µ–Ω —Ç–æ–∫|–Ω—è–º–∞ –µ–Ω–µ—Ä–≥–∏—è|NO POWER|–Ω–µ—Ç —Ç–æ–∫–∞/i;
    const needsPower = emergencyPowerKeywords.test(userMessage);

    if (!needsPower) {
        console.log(''[POWER] –ù–µ —Å–∞ —Ä–∞–∑–ø–æ–∑–Ω–∞—Ç–∏ –∫–ª—é—á–æ–≤–∏ –¥—É–º–∏ –∑–∞ —Å–ø–µ—à–Ω–æ—Å—Ç –Ω–∞ —Ç–æ–∫'');
        return "";
    }

    console.log(''[POWER] ‚ö†Ô∏è –°–ü–ï–®–ù–û–°–¢ –†–ê–ó–ü–û–ó–ù–ê–¢–ê: –ì–æ—Å—Ç –¥–æ–∫–ª–∞–¥–≤–∞ –ª–∏–ø—Å–∞ –Ω–∞ —Ç–æ–∫!'');

    // –û–í–™–†–ê–ô–î –ù–ê –ì–û–°–¢: –ê–∫–æ –≥–æ—Å—Ç —Å–µ –∂–∞–ª–∏ –Ω–∞ "–ù—è–º–∞ —Ç–æ–∫", –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤–∫–ª—é—á–≤–∞ —Ç–æ–∫–∞
    // –¢–æ–≤–∞ –µ –∑–∞—â–∏—Ç–Ω–∞ –º—è—Ä–∫–∞ - –≥–æ—Å—Ç—ä—Ç —â–µ –ø–æ–ª—É—á–∏ —Ç–æ–∫ –¥–æ—Ä–∏ –∞–∫–æ –µ –ø–ª–∞–Ω–∏—Ä–∞–Ω–æ –∏–∑–∫–ª—é—á–≤–∞–Ω–µ
    console.log(''[POWER] üö® –û–í–™–†–ê–ô–î –ù–ê –ì–û–°–¢ –ê–ö–¢–ò–í–ò–†–ê–ù: –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª–Ω–æ –≤–∫–ª—é—á–≤–∞–Ω–µ –Ω–∞ —Ç–æ–∫'');'

$newPattern = '    // –ê–í–¢–û–ú–ê–¢–ò–ó–ê–¶–ò–Ø –ù–ê –¢–û–ö: –°–∞–º–æ –∑–∞ –≥–æ—Å—Ç–∏
    if (role !== ''guest'') {
        console.log(''[POWER] –ù–µ –µ –≥–æ—Å—Ç - –ø—Ä–æ–ø—É—Å–∫–∞–º –ø—Ä–æ–≤–µ—Ä–∫–∏—Ç–µ –Ω–∞ —Ç–æ–∫'');
        return "";
    }

    // –†–∞–∑–ø–æ–∑–Ω–∞–≤–∞ –∫–ª—é—á–æ–≤–∏ –¥—É–º–∏ –Ω–∞ –±—ä–ª–≥–∞—Ä—Å–∫–∏ –µ–∑–∏–∫, —Å–≤—ä—Ä–∑–∞–Ω–∏ —Å—ä—Å —Å–ø–µ—à–Ω–∏ —Å–∏—Ç—É–∞—Ü–∏–∏
    const emergencyPowerKeywords = /–Ω—è–º–∞ —Ç–æ–∫|–±–µ–∑ —Ç–æ–∫|–Ω–µ —Ä–∞–±–æ—Ç–∏ —Ç–æ–∫|—Å–ø—Ä—è–Ω —Ç–æ–∫|–∏–∑–∫–ª—é—á–µ–Ω —Ç–æ–∫|–Ω—è–º–∞ –µ–Ω–µ—Ä–≥–∏—è|NO POWER|–Ω–µ—Ç —Ç–æ–∫–∞/i;
    const medicalEmergencyKeywords = /–±–æ–ª–µ–Ω|—Ç—Ä–∞–≤–º–∞|–∏–Ω—Ñ–∞—Ä–∫—Ç|–ø–æ–º–æ—â|—Å–ø–µ—à–Ω–æ—Å—Ç|–∑–¥—Ä–∞–≤–æ—Å–ª–æ–≤–µ–Ω|–Ω–∞—Å–∏–ª–∏–µ|–ø–æ–∂–∞—Ä/i;
    
    const needsPower = emergencyPowerKeywords.test(userMessage);
    const needsMedical = medicalEmergencyKeywords.test(userMessage);

    if (!needsPower && !needsMedical) {
        console.log(''[POWER] –ù–µ —Å–∞ —Ä–∞–∑–ø–æ–∑–Ω–∞—Ç–∏ –∫–ª—é—á–æ–≤–∏ –¥—É–º–∏ –∑–∞ —Å–ø–µ—à–Ω–æ—Å—Ç'');
        return "";
    }

    // –ú–ï–î–ò–¶–ò–ù–°–ö–ê –°–ü–ï–®–ù–û–°–¢
    if (needsMedical) {
        console.log(''[POWER] üöë –ú–ï–î–ò–¶–ò–ù–°–ö–ê –°–ü–ï–®–ù–û–°–¢ –†–ê–ó–ü–û–ó–ù–ê–¢–ê: –ì–æ—Å—Ç –∏–º–∞ –∑–¥—Ä–∞–≤–æ—Å–ª–æ–≤–Ω–∞ –ø—Ä–æ–±–ª–µ–º!'');
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤–∏–∫–∞ —Å–ø–µ—à–Ω–∞ –ø–æ–º–æ—â (112)
        console.log(''[POWER] üìû –ê–í–¢–û–ú–ê–¢–ò–ß–ù–û –ü–û–ó–í–ê–ù–ò–ï: 112 —Å–ø–µ—à–Ω–∞ –ø–æ–º–æ—â'');
        
        await automationClient.sendAlert(
            `üöë –ö–†–ò–¢–ò–ß–ù–û –ó–î–†–ê–í–û–°–õ–û–í–ù–ê –°–ü–ï–®–ù–û–°–¢: –ì–æ—Å—Ç ${bookingData?.guest_name} (${bookingData?.reservation_code}) –¥–æ–∫–ª–∞–¥–≤–∞ –∑–¥—Ä–∞–≤–æ—Å–ª–æ–≤–Ω–∞ –ø—Ä–æ–±–ª–µ–º. –ê–í–¢–û–ú–ê–¢–ò–ß–ù–û –ü–û–ó–í–ê–ù–ò–ï: –°–µ –ø—Ä–µ–ø–æ—Ä—ä—á–≤–∞ –∫–æ–Ω—Ç–∞–∫—Ç —Å—ä—Å 112 –∏–ª–∏ –º–µ—Å—Ç–Ω–∞—Ç–∞ —Å–ø–µ—à–Ω–∞ –ø–æ–º–æ—â.`,
            {
                guest_name: bookingData?.guest_name || ''–ù–µ–ø–æ–∑–Ω–∞—Ç'',
                reservation_code: bookingData?.reservation_code || ''N/A'',
                role: role,
                timestamp: new Date().toISOString(),
                action: ''medical-emergency'',
                severity: ''CRITICAL''
            }
        );
        
        return "\n\nüöë [–°–ò–°–¢–ï–ú–ê –°–ü–ï–®–ù–û–°–¢: –ì–æ–ª—è–º–æ –≤–Ω–∏–º–∞–Ω–∏–µ! –°–∏—Å—Ç–µ–º–∞—Ç–∞ –µ —Ä–∞–∑–ø–æ–∑–Ω–∞–ª–∞ –≤–µ—Ä–æ—è—Ç–Ω–∞ –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∞ —Å–ø–µ—à–Ω–æ—Å—Ç. –ü–†–ï–ü–û–†–™–ß–ê–ù–ò–ï: –ü–æ–∑–≤–æ–Ω–∏ 112 –∏–ª–∏ –º–µ—Å—Ç–Ω–∏ —Å–ø–µ—à–Ω–∏ —Å–ª—É–∂–±–∏ –≤–µ–¥–Ω–∞–≥–∞! –î–æ–º–∞–∫–∏–Ω—ä—Ç –µ –∏–∑–≤–µ—Å—Ç–µ–Ω –∑–∞ –≤–∞—à–∞—Ç–∞ —Å–∏—Ç—É–∞—Ü–∏—è.]";
    }

    console.log(''[POWER] ‚ö†Ô∏è –°–ü–ï–®–ù–û–°–¢ –†–ê–ó–ü–û–ó–ù–ê–¢–ê: –ì–æ—Å—Ç –¥–æ–∫–ª–∞–¥–≤–∞ –ª–∏–ø—Å–∞ –Ω–∞ —Ç–æ–∫!'');

    // –û–í–™–†–ê–ô–î –ù–ê –ì–û–°–¢: –ê–∫–æ –≥–æ—Å—Ç —Å–µ –∂–∞–ª–∏ –Ω–∞ "–ù—è–º–∞ —Ç–æ–∫", –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤–∫–ª—é—á–≤–∞ —Ç–æ–∫–∞
    // –¢–æ–≤–∞ –µ –∑–∞—â–∏—Ç–Ω–∞ –º—è—Ä–∫–∞ - –≥–æ—Å—Ç—ä—Ç —â–µ –ø–æ–ª—É—á–∏ —Ç–æ–∫ –¥–æ—Ä–∏ –∞–∫–æ –µ –ø–ª–∞–Ω–∏—Ä–∞–Ω–æ –∏–∑–∫–ª—é—á–≤–∞–Ω–µ
    console.log(''[POWER] üö® –û–í–™–†–ê–ô–î –ù–ê –ì–û–°–¢ –ê–ö–¢–ò–í–ò–†–ê–ù: –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª–Ω–æ –≤–∫–ª—é—á–≤–∞–Ω–µ –Ω–∞ —Ç–æ–∫'');'

$newContent = $content -replace [regex]::Escape($oldPattern), $newPattern

Set-Content 'c:\dev\smart-stay\services\ai_service.js' -Value $newContent -Encoding UTF8
Write-Host "Medical emergency expansion complete"
