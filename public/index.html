<!DOCTYPE html>
<html lang="bg">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Smart Stay Concierge</title>
    <style>
        /* --- –ú–û–î–ï–†–ï–ù UI (App-like) --- */
        :root {
            --primary-color: #0084ff; /* Messenger Blue */
            --bg-color: #f0f2f5;
            --my-msg-bg: #0084ff;
            --bot-msg-bg: #e4e6eb;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            margin: 0;
            padding: 0;
            /* 100dvh –µ –º–∞–≥–∏—è—Ç–∞ –∑–∞ –º–æ–±–∏–ª–Ω–∏ –±—Ä–∞—É–∑—ä—Ä–∏ - –∑–∞–µ–º–∞ —Ç–æ—á–Ω–æ –≤–∏–¥–∏–º–∞—Ç–∞ —á–∞—Å—Ç */
            height: 100dvh; 
            display: flex;
            flex-direction: column;
            overflow: hidden; /* –°–ø–∏—Ä–∞ —Å–∫—Ä–æ–ª–∞ –Ω–∞ —Ü—è–ª–∞—Ç–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ */
        }

        /* –•–µ–¥—ä—Ä - –§–∏–∫—Å–∏—Ä–∞–Ω –≥–æ—Ä–µ */
        header {
            background: white;
            padding: 15px;
            text-align: center;
            font-weight: 600;
            font-size: 18px;
            color: #333;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
            z-index: 10;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        /* –û—Å–Ω–æ–≤–Ω–∞ –∑–æ–Ω–∞ –∑–∞ —á–∞—Ç - –°–∫—Ä–æ–ª–≤–∞ —Å–µ */
        #chat-box {
            flex: 1; /* –ó–∞–µ–º–∞ —Ü—è–ª–æ—Ç–æ —Å–≤–æ–±–æ–¥–Ω–æ –º—è—Å—Ç–æ */
            overflow-y: auto; /* –°–∞–º–æ —Ç–æ —Å–µ —Å–∫—Ä–æ–ª–≤–∞ */
            padding: 15px;
            display: flex;
            flex-direction: column;
            gap: 8px;
            scroll-behavior: smooth;
            -webkit-overflow-scrolling: touch; /* –ú–∞–∑–µ–Ω —Å–∫—Ä–æ–ª –∑–∞ iOS */
        }

        /* –°—ä–æ–±—â–µ–Ω–∏—è */
        .message {
            max-width: 85%;
            padding: 10px 14px;
            border-radius: 18px;
            font-size: 15px;
            line-height: 1.4;
            position: relative;
            word-wrap: break-word;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        .bot {
            background: var(--bot-msg-bg);
            color: #050505;
            align-self: flex-start;
            border-bottom-left-radius: 4px;
        }

        .user {
            background: var(--primary-color);
            color: white;
            align-self: flex-end;
            border-bottom-right-radius: 4px;
        }

        /* –ó–æ–Ω–∞ –∑–∞ –ø–∏—Å–∞–Ω–µ - –§–∏–∫—Å–∏—Ä–∞–Ω–∞ –¥–æ–ª—É */
        .input-area {
            background: white;
            padding: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
            border-top: 1px solid #ddd;
            /* –ë–µ–∑–æ–ø–∞—Å–Ω–∞ –∑–æ–Ω–∞ –∑–∞ iPhone X/11/12/13/14 */
            padding-bottom: env(safe-area-inset-bottom, 10px); 
        }

        input {
            flex: 1;
            padding: 12px 15px;
            background: #f0f2f5;
            border: none;
            border-radius: 20px;
            font-size: 16px; /* 16px —Å–ø–∏—Ä–∞ –∑—É—É–º–∞ –Ω–∞ iPhone –ø—Ä–∏ –ø–∏—Å–∞–Ω–µ */
            outline: none;
        }

        button {
            background: none;
            border: none;
            color: var(--primary-color);
            font-size: 20px;
            cursor: pointer;
            padding: 5px 10px;
            transition: transform 0.1s;
        }
        button:active { transform: scale(0.9); }

        /* –ê–Ω–∏–º–∞—Ü–∏—è "–ü–∏—à–µ..." */
        .typing-indicator {
            display: none;
            align-self: flex-start;
            background: var(--bot-msg-bg);
            padding: 8px 12px;
            border-radius: 15px;
            margin-bottom: 5px;
            color: #666;
            font-size: 12px;
            font-style: italic;
        }
        
        /* –°–ø–µ—Ü–∏–∞–ª–µ–Ω —Å—Ç–∏–ª –∑–∞ –ü–ò–ù –∫–æ–¥–æ–≤–µ –≤ —Ç–µ–∫—Å—Ç–∞ */
        .highlight-pin {
            background: #fff;
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: bold;
            border: 1px solid #ccc;
            font-family: monospace;
            font-size: 1.1em;
        }
    </style>
</head>
<body>

    <header>
        ü§ñ <span>–î–∏–≥–∏—Ç–∞–ª–µ–Ω –ê—Å–∏—Å—Ç–µ–Ω—Ç</span>
    </header>

    <div id="chat-box">
        <div class="message bot">
            –ó–¥—Ä–∞–≤–µ–π—Ç–µ! –ê–∑ —Å—ä–º –≤–∞—à–∏—è—Ç –≤–∏—Ä—Ç—É–∞–ª–µ–Ω –¥–æ–º–∞–∫–∏–Ω. üëã<br><br>
            –ù–∞–ø–∏—à–µ—Ç–µ –≤–∞—à–∏—è <b>–ö–æ–¥ –∑–∞ —Ä–µ–∑–µ—Ä–≤–∞—Ü–∏—è</b>, –∑–∞ –¥–∞ –≤–∏ –¥–∞–º –¥–æ—Å—Ç—ä–ø –¥–æ –∞–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–∞.
        </div>
        <div class="typing-indicator" id="loader">‚óè ‚óè ‚óè</div>
    </div>

    <div class="input-area">
        <input type="text" id="user-input" placeholder="–°—ä–æ–±—â–µ–Ω–∏–µ..." autocomplete="off">
        <button onclick="sendMessage()">‚û§</button>
    </div>

    <script>
        // =======================================================
        // ‚ö†Ô∏è –í–ê–ñ–ù–û: –°–ª–æ–∂–∏ —Ç—É–∫ –∏—Å—Ç–∏–Ω—Å–∫–∏—è –ª–∏–Ω–∫ –æ—Ç Render!
        // =======================================================
        const BACKEND_URL = 'https://tvoyat-backend-v-render.onrender.com'; 
        // =======================================================

        const chatBox = document.getElementById('chat-box');
        const userInput = document.getElementById('user-input');
        const loader = document.getElementById('loader');

        // –ü—Ä–∞—â–∞–Ω–µ —Å Enter
        userInput.addEventListener('keypress', function (e) {
            if (e.key === 'Enter') sendMessage();
        });

        async function sendMessage() {
            const text = userInput.value.trim();
            if (!text) return;

            // 1. –ü–æ–∫–∞–∑–≤–∞–º–µ —Å—ä–æ–±—â–µ–Ω–∏–µ—Ç–æ –Ω–∞ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—è
            addMessage(text, 'user');
            userInput.value = '';
            
            // 2. –ü–æ–∫–∞–∑–≤–∞–º–µ –∞–Ω–∏–º–∞—Ü–∏—è—Ç–∞
            loader.style.display = 'block';
            chatBox.scrollTop = chatBox.scrollHeight;

            try {
                const response = await fetch(`${BACKEND_URL}/chat`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message: text })
                });

                const data = await response.json();
                
                // 3. –ú–∞—Ö–∞–º–µ –∞–Ω–∏–º–∞—Ü–∏—è—Ç–∞ –∏ –ø–æ–∫–∞–∑–≤–∞–º–µ –æ—Ç–≥–æ–≤–æ—Ä–∞
                loader.style.display = 'none';
                addMessage(data.reply, 'bot');

            } catch (error) {
                loader.style.display = 'none';
                addMessage("‚ö†Ô∏è –ù—è–º–∞ –≤—Ä—ä–∑–∫–∞. –ú–æ–ª—è –ø—Ä–æ–≤–µ—Ä–µ—Ç–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç –≤—Ä—ä–∑–∫–∞—Ç–∞ —Å–∏.", 'bot');
                console.error(error);
            }
        }

        function addMessage(text, sender) {
            const msgDiv = document.createElement('div');
            msgDiv.classList.add('message', sender);
            
            // –§–æ—Ä–º–∞—Ç–∏—Ä–∞–Ω–µ –Ω–∞ —Ç–µ–∫—Å—Ç (Bold –∏ PIN –∫–æ–¥–æ–≤–µ)
            let formatted = text
                .replace(/\n/g, '<br>')
                .replace(/\*\*(.*?)\*\*/g, '<b>$1</b>') // Bold
                .replace(/CHECK_CODE: (.*)/g, ''); // –ö—Ä–∏–µ–º —Å–∏—Å—Ç–µ–º–Ω–∏—Ç–µ –∫–æ–¥–æ–≤–µ –∞–∫–æ –∏–∑–ª—è–∑–∞—Ç

            msgDiv.innerHTML = formatted;
            
            // –í–º—ä–∫–≤–∞–º–µ –ü–†–ï–î–ò loader-–∞
            chatBox.insertBefore(msgDiv, loader);
            chatBox.scrollTop = chatBox.scrollHeight;
        }
    </script>

</body>
</html>