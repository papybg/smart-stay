<!DOCTYPE html>
<html lang="bg">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Stay Admin</title>
    <style>
        body { font-family: sans-serif; max-width: 800px; margin: 20px auto; padding: 20px; background: #f4f4f9; }
        h1 { text-align: center; color: #333; }
        .form-group { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        input { width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box; }
        button { width: 100%; padding: 10px; background: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 16px; }
        button:hover { background: #218838; }
        table { width: 100%; margin-top: 20px; border-collapse: collapse; background: white; }
        th, td { padding: 12px; border-bottom: 1px solid #ddd; text-align: left; }
        th { background: #007bff; color: white; }
    </style>
</head>
<body>

    <h1>üè® –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ –†–µ–∑–µ—Ä–≤–∞—Ü–∏–∏</h1>

    <div class="form-group">
        <h3>‚ûï –ù–æ–≤–∞ —Ä–µ–∑–µ—Ä–≤–∞—Ü–∏—è</h3>
        <input type="text" id="guest_name" placeholder="–ò–º–µ –Ω–∞ –≥–æ—Å—Ç–∞ (–Ω–∞–ø—Ä. Ivan Petrov)">
        
        <label>–î–∞—Ç–∞ –∏ —á–∞—Å –Ω–∞ –ø—Ä–∏—Å—Ç–∏–≥–∞–Ω–µ:</label>
        <input type="datetime-local" id="check_in">
        
        <label>–î–∞—Ç–∞ –∏ —á–∞—Å –Ω–∞ –Ω–∞–ø—É—Å–∫–∞–Ω–µ:</label>
        <input type="datetime-local" id="check_out">
        
        <input type="text" id="reservation_code" placeholder="–ö–æ–¥ –∑–∞ —Ä–µ–∑–µ—Ä–≤–∞—Ü–∏—è (–Ω–∞–ø—Ä. RES123)">
        <button onclick="addBooking()">–ó–∞–ø–∏—à–∏ –≤ Neon DB</button>
    </div>

    <h3>üìã –°–ø–∏—Å—ä–∫ —Å —Ä–µ–∑–µ—Ä–≤–∞—Ü–∏–∏</h3>
    <table id="bookings-table">
        <thead>
            <tr>
                <th>–ò–º–µ</th>
                <th>–ü—Ä–∏—Å—Ç–∏–≥–∞</th>
                <th>–ù–∞–ø—É—Å–∫–∞</th>
                <th>–ö–æ–¥</th>
                <th>–ü–ò–ù (–ê–≤—Ç–æ)</th>
            </tr>
        </thead>
        <tbody id="table-body"></tbody>
    </table>

    <script>
        // –¢–£–ö –ï –ö–õ–Æ–ß–™–¢! –í–µ—á–µ —Å–æ—á–∏ –¥–∏—Ä–µ–∫—Ç–Ω–æ –∫—ä–º –æ–±–ª–∞–∫–∞
        const API_URL = 'https://smart-stay.onrender.com';

        async function addBooking() {
            const guest_name = document.getElementById('guest_name').value;
            const check_in = document.getElementById('check_in').value;
            const check_out = document.getElementById('check_out').value;
            const reservation_code = document.getElementById('reservation_code').value;

            if(!guest_name || !check_in || !check_out || !reservation_code) {
                alert("–ú–æ–ª—è, –ø–æ–ø—ä–ª–Ω–µ—Ç–µ –≤—Å–∏—á–∫–∏ –ø–æ–ª–µ—Ç–∞!");
                return;
            }

            // –ü—Ä–µ–æ–±—Ä–∞–∑—É–≤–∞–º–µ –¥–∞—Ç–∞—Ç–∞ –≤ —Ñ–æ—Ä–º–∞—Ç, –∫–æ–π—Ç–æ –±–∞–∑–∞—Ç–∞ —Ö–∞—Ä–µ—Å–≤–∞ (Postgres)
            const formattedCheckIn = check_in.replace('T', ' ') + ':00';
            const formattedCheckOut = check_out.replace('T', ' ') + ':00';

            try {
                const res = await fetch(`${API_URL}/add-booking`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        guest_name, 
                        check_in: formattedCheckIn, 
                        check_out: formattedCheckOut, 
                        reservation_code 
                    })
                });

                const data = await res.json();
                if (data.success) {
                    alert(`‚úÖ –ì–æ—Ç–æ–≤–æ! –ü–ò–ù –∫–æ–¥—ä—Ç –µ: ${data.booking.lock_pin}`);
                    loadBookings(); // –ü—Ä–µ–∑–∞—Ä–µ–∂–¥–∞ —Ç–∞–±–ª–∏—Ü–∞—Ç–∞
                    // –ß–∏—Å—Ç–∏–º –ø–æ–ª–µ—Ç–∞—Ç–∞
                    document.getElementById('guest_name').value = '';
                    document.getElementById('reservation_code').value = '';
                } else {
                    alert('–ì—Ä–µ—à–∫–∞: ' + data.error);
                }
            } catch (err) {
                alert('–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –≤—Ä—ä–∑–∫–∞ —Å—ä—Å —Å—ä—Ä–≤—ä—Ä–∞: ' + err.message);
            }
        }

        async function loadBookings() {
            try {
                const res = await fetch(`${API_URL}/bookings`);
                const bookings = await res.json();
                
                const tbody = document.getElementById('table-body');
                tbody.innerHTML = '';

                bookings.forEach(b => {
                    // –§–æ—Ä–º–∞—Ç–∏—Ä–∞–Ω–µ –Ω–∞ –¥–∞—Ç–∏—Ç–µ –∑–∞ –ø–æ-–∫—Ä–∞—Å–∏–≤–æ
                    const inDate = new Date(b.check_in).toLocaleString('bg-BG');
                    const outDate = new Date(b.check_out).toLocaleString('bg-BG');

                    const row = `<tr>
                        <td>${b.guest_name}</td>
                        <td>${inDate}</td>
                        <td>${outDate}</td>
                        <td><b>${b.reservation_code}</b></td>
                        <td>üîê ${b.lock_pin}</td>
                    </tr>`;
                    tbody.innerHTML += row;
                });
            } catch (err) {
                console.error("–ù–µ –º–æ–≥–∞ –¥–∞ –∑–∞—Ä–µ–¥—è —Ä–µ–∑–µ—Ä–≤–∞—Ü–∏–∏—Ç–µ:", err);
            }
        }

        // –ó–∞—Ä–µ–∂–¥–∞ —Å–ø–∏—Å—ä–∫–∞ –≤–µ–¥–Ω–∞–≥–∞ —â–æ–º –æ—Ç–≤–æ—Ä–∏—à —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ç–∞
        loadBookings();
    </script>

</body>
</html>