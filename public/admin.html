<!DOCTYPE html>
<html lang="bg">
<head>
    <meta charset="UTF-8">
    <title>Smart Stay - –ê–¥–º–∏–Ω</title>
    <style>
        body { font-family: sans-serif; max-width: 600px; margin: 20px auto; padding: 20px; }
        input, button { display: block; width: 100%; margin-bottom: 10px; padding: 10px; }
        button { background: #007bff; color: white; border: none; cursor: pointer; }
        button:hover { background: #0056b3; }
        .booking { border: 1px solid #ddd; padding: 10px; margin-top: 10px; border-radius: 5px; background: #f9f9f9; }
    </style>
</head>
<body>
    <h1>üè® –ù–æ–≤–∞ –†–µ–∑–µ—Ä–≤–∞—Ü–∏—è</h1>
    <form id="bookingForm">
        <input type="text" id="guest_name" placeholder="–ò–º–µ –Ω–∞ –≥–æ—Å—Ç–∞" required>
        <input type="text" id="reservation_code" placeholder="–ö–æ–¥ –æ—Ç Airbnb (–Ω–∞–ø—Ä. HMW123)" required>
        <label>–ù–∞—Å—Ç–∞–Ω—è–≤–∞–Ω–µ:</label>
        <input type="datetime-local" id="check_in" required>
        <label>–ù–∞–ø—É—Å–∫–∞–Ω–µ:</label>
        <input type="datetime-local" id="check_out" required>
        <button type="submit">–ó–ê–ü–ò–®–ò –†–ï–ó–ï–†–í–ê–¶–ò–Ø–¢–ê</button>
    </form>

    <h2>üìú –°–ø–∏—Å—ä–∫ —Å –≥–æ—Å—Ç–∏</h2>
    <div id="list">–ó–∞—Ä–µ–∂–¥–∞–Ω–µ...</div>

    <script>
        const API_URL = 'http://localhost:10000';

        // 1. –§—É–Ω–∫—Ü–∏—è –∑–∞ –¥–æ–±–∞–≤—è–Ω–µ
        document.getElementById('bookingForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const data = {
                guest_name: document.getElementById('guest_name').value,
                reservation_code: document.getElementById('reservation_code').value,
                check_in: document.getElementById('check_in').value,
                check_out: document.getElementById('check_out').value
            };

            const res = await fetch(`${API_URL}/add-booking`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            });

            const response = await res.json();
            if (response.success) {
                alert(`–ì–æ—Ç–æ–≤–æ! –ì–µ–Ω–µ—Ä–∏—Ä–∞–Ω –ü–ò–ù –∫–æ–¥ –∑–∞ –≤—Ä–∞—Ç–∞—Ç–∞: ${response.booking.lock_pin}`);
                loadBookings(); // –ü—Ä–µ–∑–∞—Ä–µ–¥–∏ —Å–ø–∏—Å—ä–∫–∞
            } else {
                alert('–ì—Ä–µ—à–∫–∞: ' + response.error);
            }
        });

        // 2. –§—É–Ω–∫—Ü–∏—è –∑–∞ –ø–æ–∫–∞–∑–≤–∞–Ω–µ –Ω–∞ —Å–ø–∏—Å—ä–∫–∞
        async function loadBookings() {
            const res = await fetch(`${API_URL}/bookings`);
            const bookings = await res.json();
            const list = document.getElementById('list');
            list.innerHTML = bookings.map(b => `
                <div class="booking">
                    <strong>${b.guest_name}</strong> (–ö–æ–¥ Airbnb: ${b.reservation_code})<br>
                    üîê –ü–ò–ù –∑–∞ –≤—Ä–∞—Ç–∞: <strong>${b.lock_pin}</strong><br>
                    üìÖ –û—Ç: ${new Date(b.check_in).toLocaleString()} –î–æ: ${new Date(b.check_out).toLocaleString()}
                </div>
            `).join('');
        }

        loadBookings(); // –ó–∞—Ä–µ–¥–∏ –≤–µ–¥–Ω–∞–≥–∞ –ø—Ä–∏ –æ—Ç–≤–∞—Ä—è–Ω–µ
    </script>
</body>
</html>