<!DOCTYPE html>
<html lang="bg">
<head>
    <meta charset="UTF-8">
    <title>Smart Stay Remote</title>
    <style>
        body { background: #121212; color: white; font-family: sans-serif; text-align: center; padding-top: 50px; }
        .power-btn { 
            width: 180px; height: 180px; border-radius: 50%; border: 8px solid #333;
            cursor: pointer; font-size: 24px; font-weight: bold; transition: 0.4s;
            outline: none; background: #222;
        }
        .on { color: #00ff88; border-color: #00ff88; box-shadow: 0 0 30px #00ff88; }
        .off { color: #555; border-color: #333; }
        .status-info { margin-top: 30px; font-size: 18px; color: #aaa; }
    </style>
</head>
<body>
    <h1>КОНТРОЛ НА ТОКА</h1>
    <button id="btn" class="power-btn off" onclick="toggle()">...</button>
    <div id="st" class="status-info">Синхронизиране...</div>

    <script>
        const API = ''; // Оставяме празно, за да търси сървъра автоматично (relative path)

        async function getStatus() {
            try {
                const res = await fetch(`${API}/status`);
                const data = await res.json();
                const btn = document.getElementById('btn');
                btn.innerText = data.is_on ? 'ВКЛЮЧЕН' : 'ИЗКЛЮЧЕН';
                btn.className = 'power-btn ' + (data.is_on ? 'on' : 'off');
                document.getElementById('st').innerText = 'Реално състояние: ' + (data.is_on ? 'РАБОТИ' : 'СПРЯНО');
            } catch (e) { document.getElementById('st').innerText = 'Няма връзка със сървъра'; }
        }

        async function toggle() {
            document.getElementById('st').innerText = 'Изпращане на команда...';
            await fetch(`${API}/toggle`);
            getStatus();
        }

        // Автоматично опресняване на статуса на всеки 10 секунди
        setInterval(getStatus, 10000);
        getStatus();
    </script>
</body>
</html>